<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>asmr库</title>
	<!-- Bootstrap 的 CSS 文件 -->
	<!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-p1KAotb3W9ndluCsqePPYnjRm3c6abdnIjo0tQwYUv83VsbsYd43RuofnFAaDo0E" crossorigin="anonymous">-->
	<!--<link type="text/css" href="css/bootstrap.min.css" rel="stylesheet ">-->
	<link rel="stylesheet" type="text/css" href="css/listCss.css">
	<link rel="stylesheet" href="css/player.css">
	<link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.6.1/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
	<div class="alert alert-primary" role="alert">
		请点击左侧播放器播放!
	</div>
	<!------------------------------------------------------------------------------主页-------------------------------------------------------------------------->

	<div class="accordion" id="accordionExample">
		<div class="card">
			<div class="card-header" id="headingOne">
				<h2 class="mb-0">
					<button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
						Asmr库 (点此收缩/张开)
					</button>
				</h2>
			</div>

			<div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
				<div class="card-body">
					<div class="container">
						<!--<div class="row">-->
							<!--<div class="col-sm ">-->
								<!--<div class="card" style="width: 18rem;">-->
									<!--<img src="img/1.jpg" class="card-img-top" alt="...">-->
									<!--<div class="card-body">-->
										<!--<h5 class="card-title">Card title</h5>-->
										<!--<p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>-->
										<!--<button type="button" class="btn btn-primary addToList">Primary</button>-->
									<!--</div>-->
								<!--</div>-->
							<!--</div>-->
							<!--<div class="col-sm ">-->
								<!--<div class="card" style="width: 18rem;">-->
									<!--<img src="img/3.png" class="card-img-top" alt="...">-->
									<!--<div class="card-body">-->
										<!--<h5 class="card-title">Card title</h5>-->
										<!--<p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>-->
										<!--<button  type="button" class="btn btn-primary addToList" >Primary</button>-->
									<!--</div>-->
								<!--</div>-->
							<!--</div>-->



						<!--</div>-->



					</div>
				</div>
			</div>
		</div>
		<div class="card">
			<div class="card-header" id="headingTwo">
				<h2 class="mb-0">
					<button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
						播放列表
					</button>
				</h2>
			</div>
			<div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
				<div class="card-body">
					<button type="button" id="clear" class="btn btn-warning">清空播放列表</button>
				</div>
			</div>
		</div>
		<div class="card">
			<div class="card-header" id="headingThree">
				<h2 class="mb-0">
					<button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
						关于
					</button>
				</h2>
			</div>
			<div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
				<div class="card-body">
					<h3 style="color: red">如网络不流畅请使用vpn访问</h3>
					<h3 style="color: red">后续会增加音频资源</h3>
					<h3 style="color: red">交流请加qq群:824343666</h3>
				</div>
			</div>
		</div>
	</div>




	<!--------------------------------------------------------------------------------------------------播放器-------------------------------------------------------------------------------->
<div id="QPlayer">
<div id="pContent">
	<div id="player">
		<span class="cover"></span>
		<div class="ctrl">
			<div class="musicTag marquee">
				<strong>Title</strong>
				 <span> - </span>
				<span class="artist">Artist</span>
			</div>
			<div class="progress">
				<div class="timer left">0:00</div>
				<div class="contr">
					<div class="rewind icon"></div>
					<div class="playback icon"></div>
					<div class="fastforward icon"></div>
				</div>
				<div class="right">
					<div class="liebiao icon"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="ssBtn">
	        <div class="adf"></div>
    </div>
</div>
<ol id="playlist"></ol>
</div>

<!--<script src="js/jquery.min.js"></script>-->
<script src="js/jquery.marquee.min.js"></script>
	<!-- 选项 1：jQuery 和 Bootstrap 集成包（集成了 Popper） -->
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.6.1/js/bootstrap.js"></script>
	<!--引入消息弹框插件 官网https://oct.cn/project/pxmu/-->
	<script type="text/javascript" src="https://unpkg.com/pxmu/dist/web/pxmu.min.js"></script>
<script>

	var	playlist = [
		{title:"默认提示音,请添加音乐",artist:"-",mp3:"./mp3/def.mp3",cover:"http://p2.music.126.net/OAaxmYfsDZNXPk9H_h4pMQ==/109951165369903131.jpg?param=130y130"},
//		{title:"光年之外",artist:"邓紫棋",mp3:"./mp3/guangnianzhiwai.mp3",cover:"http://p2.music.126.net/fkqFqMaEt0CzxYS-0NpCog==/18587244069235039.jpg?param=130y130",},

];

	var isRotate = true;
  	var autoplay = false;
	var list = [];
//	加载首页
	$.ajax({
		url: "./list.json",
		dataType:"json",
		success:function(data){
			var length = data.length;
			$.each(data,function(index,music){
				list = data;
				var $item = createMusicItem(index,length,music);
			})
			loadTempToList();
			//删除默认歌曲
			playlist.splice(0, 1);
			loadList();
//			$("#player audio").eq(0).remove();

		},
		error:function(e){
			console.log(e);
		}
	})

</script>
<script src="js/player.js"></script>
<script>

function bgChange(){
	var lis= $('.lib');
	for(var i=0; i<lis.length; i+=2)
	lis[i].style.background = 'rgba(246, 246, 246, 0.5)';
}
function loadTempToList(){
	var playListTemp = localStorage.getItem("playListStorage");
	if(playListTemp != null){
		var temp = [];
		temp = JSON.parse(playListTemp);
		$.each(temp,function(index,i){
			console.log(i);
			playlist.push(list[i]);
			console.log("push:",list[i]);
		})
	}
}
function addMusic(index){
//	var list = [1,3,2,5,12];
//	localStorage.setItem("playListStorage",JSON.stringify(list));
	var playListStorage = localStorage.getItem("playListStorage");
	var list = [];

	if(playListStorage != null){
		list = JSON.parse(playListStorage);
		if(list.indexOf(index) == -1){
			//不存在则添加
			list.push(index);
			successMsg("添加成功")
			localStorage.setItem("playListStorage",JSON.stringify(list));
			addToList(index);
		}else{
			//存在
			errorMsg("播放列表已存在");
		}

	}else{
		list.push(index);
		successMsg("添加成功")
		localStorage.setItem("playListStorage",JSON.stringify(list));
		location.replace(location);
//		$('#playlist li').remove();
//		addToList(index);
//		loadMusic(0);

	}


//	playlist = [
//		{title:"光年之外2",artist:"邓紫棋",mp3:"./mp3/guangnianzhiwai.mp3",cover:"http://p2.music.126.net/fkqFqMaEt0CzxYS-0NpCog==/18587244069235039.jpg?param=130y130",},
//		{title:"孤独2",artist:"邓紫棋",mp3:"./mp3/gudu.mp3",cover:"http://p2.music.126.net/OAaxmYfsDZNXPk9H_h4pMQ==/109951165369903131.jpg?param=130y130"},
//	]
}
function addToList(index){
	var item = list[index];
	console.log(item);
	playlist.push(item);
	$('#playlist').append('<li class="lib" style="overflow:hidden;"><strong style="margin-left: 5px;">'+item.title+'</strong><span style="float: right;" class="artist">'+item.artist+'</span></li>');
	if (item.mp3 == "") {
		$('#playlist li').last.css('color', '#ddd');
	}
}
function loadList(){

	loadMusic(0);
	$('#playlist li').remove();
	for (var i = 0; i < playlist.length; i++){
		var item = playlist[i];
		$('#playlist').append('<li class="lib" style="overflow:hidden;"><strong style="margin-left: 5px;">'+item.title+'</strong><span style="float: right;" class="artist">'+item.artist+'</span></li>');
		if (item.mp3 == "") {
			$('#playlist li').eq(i).css('color', '#ddd');
		}
	}
}

function createMusicItem(index,length,music){

	if(index%2 == 0){

		$(".container").append('<div class="row">');
		$(".container").append('<div class="col-sm ">'+
		'<div class="card" style="width: 18rem;">'+
		'<img src="'+music.cover+'" class="card-img-top" alt="...">'+
		'<div class="card-body">'+
		'<h5 class="card-title">'+music.title+'</h5>'+
		'<p class="card-text">'+music.artist+'</p> '+
		'<button type="button" class="btn btn-primary addToList" data-index="'+index+'">添加到播放列表</button>'+
		'</div>'+
		'</div>'+
		'</div>');

//		如果奇数个结束
		if((index+1) == length){
			$(".container").append('</div>');
		}
	}else{

		$(".container").append('<div class="col-sm ">'+
		'<div class="card" style="width: 18rem;">'+
		'<img src="'+music.cover+'" class="card-img-top" alt="...">'+
		'<div class="card-body">'+
		'<h5 class="card-title">'+music.title+'</h5>'+
		'<p class="card-text">'+music.artist+'</p> '+
		'<button type="button" class="btn btn-primary addToList" data-index="'+index+'">添加到播放列表</button>'+
		'</div>'+
		'</div>'+
		'</div>');

		$(".container").append('</div>');
	}



}
var loadMusic = function(i){
	$('audio').remove();
	var item = playlist[i];
	while (item.mp3 == "") {
		showNotification('歌曲地址为空，已自动跳过');
		if (isShuffle) {
			if (++shuffleIndex === shuffleArray.length) {
				shuffleIndex = 0;
			}
			i = currentTrack = shuffleArray[shuffleIndex];
		} else {
			currentTrack = ++i;
		}
		item = playlist[i];
	}
	var newaudio = $('<audio>').html('<source src="'+item.mp3+'"><source src="'+item.ogg+'">').appendTo('#player');
	$('.cover').html('<img src="'+item.cover+'" alt="'+item.album+'">');
	$('.musicTag').html('<strong>'+item.title+'</strong><span> - </span><span class="artist">'+item.artist+'</span>');
	$('#playlist li').removeClass('playing').eq(i).addClass('playing');
	audio = newaudio[0];
	audio.addEventListener('progress', beforeLoad, false);
	audio.addEventListener('durationchange', beforeLoad, false);
	audio.addEventListener('canplay', afterLoad, false);
	audio.addEventListener('ended', ended, false);
};
function errorMsg(msg){
	pxmu.fail({
		msg: msg, //loading信息 为空时不显示文本
		time: 800, //停留时间
		bg: 'rgba(0, 0, 0, 0.65)', //背景色
		color: '#fff', //文字颜色
		animation: 'slidedown', //动画名 详见动画文档
		close: true, // 自动关闭 为false时可在业务完成后调用 pxmu.closeload();手动关闭
		inscroll: false, //模态 不可点击和滚动
		inscrollbg : 'rgba(0, 0, 0, 0)'//自定义遮罩层颜色 为空不显示遮罩层
	})
}

function successMsg(msg){
	pxmu.success({
		msg: msg, //loading信息 为空时不显示文本
		time: 800, //停留时间
		bg: 'rgba(0, 0, 0, 0.65)', //背景色
		color: '#fff', //文字颜色
		animation: 'slidedown', //动画名 详见动画文档
		close: true, // 自动关闭 为false时可在业务完成后调用 pxmu.closeload();手动关闭
		inscroll: false, //模态 不可点击和滚动
		inscrollbg : 'rgba(0, 0, 0, 0)'//自定义遮罩层颜色 为空不显示遮罩层
	})
}



$(".container").on("click",".addToList",function(){
	var index = $(this).data('index');
//	console.log(list[index]);
	var music = list[index];
	addMusic(index);

})

$("#clear").on("click",function(){
	localStorage.removeItem("playListStorage");
	successMsg("已清空播放列表");
	setTimeout("location.replace(location)",500);

})

var ended = function(){
	pause();
	audio.currentTime = 0;
	if (isShuffle){
		shufflePlay(1);
	} else {
		if (currentTrack < playlist.length) switchTrack(++currentTrack);
	}

}

var beforeLoad = function(){
	var endVal = this.seekable && this.seekable.length ? this.seekable.end(0) : 0;
}

// Fire when track loaded completely
var afterLoad = function(){
	if (autoplay == true) play();
}

window.onload = bgChange;
</script>


</body>
</html>
